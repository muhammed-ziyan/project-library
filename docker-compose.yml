version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: project-library
    ports:
      - "3000:3000"  # Backend API
      - "8080:8080"  # Frontend
    environment:
      # Backend environment variables
      - NODE_ENV=production
      - PORT=3000
      - DATABASE_URL=file:/app/backend/prisma/dev.db
      - STORAGE_PATH=/app/backend/storage
      - FRONTEND_URL=http://localhost:8080
      - JWT_SECRET=${JWT_SECRET:-change-this-secret-key-in-production}
      - ADMIN_KEY=${ADMIN_KEY:-change-this-admin-key-in-production}
      # Frontend environment variables
      - NEXT_PUBLIC_API_URL=http://localhost:3000
      - NEXT_PUBLIC_APP_NAME=Project Library
      - NEXT_PUBLIC_APP_DESCRIPTION=A comprehensive web-based Project Library platform for AI/ML school projects
    volumes:
      # Persist SQLite database
      - ./backend/prisma:/app/backend/prisma
      # Persist uploaded files and project storage
      - ./backend/storage:/app/backend/storage
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
