# Project Library – Build Spec (for Cursor AI)

**Goal:** Build an open‑source Project Library web app for AI/ML school projects. Students filter projects by class, subject, difficulty, tags, and levels; view a project’s details; enroll; follow step‑by‑step guided/semi‑guided flows with checklists; and submit outcomes. Content is sourced from uploaded JSON files (one file per project) and persisted to Postgres via Prisma. The app supports dark/light mode (default dark). Repo has separate `/frontend` and `/backend` folders.

---

## 1) Tech & Standards

* **Frontend:** Next.js 14 (App Router) + React 18, TypeScript, Tailwind CSS, shadcn/ui, `next-themes` for dark/light, Zod for client validation, TanStack Query for data fetching, React Hook Form for forms.
* **Backend:** Node.js 20 + Fastify, TypeScript, Prisma ORM, Postgres, Zod for schema validation. Optional file storage: local `/storage/projects` or S3-compatible.
* **Auth (MVP):** Anonymous enrollment with required email; optionally add NextAuth later.
* **API style:** REST (JSON). Use `application/json`. All inputs validated by Zod; respond with RFC 7807 error shape.
* **Env:** `DATABASE_URL`, `PORT`, `NODE_ENV`, `FILE_STORAGE_DIR` (or S3 creds).
* **Theme:** Dark by default, toggleable via `next-themes`. Avoid hard-coded brand colors; keep neutral grays. User will add colors later.

---

## 2) Monorepo Structure

```
project-library/
  frontend/
    src/
      app/                  # Next.js App Router
        (marketing)/        # Landing/home
        browse/             # Filterable project catalog
        project/[slug]/     # Project detail page
        learn/[enrollmentId]/  # Guided flow (steps/checklist)
        submit/[enrollmentId]/ # Submission page
        admin/upload/       # Admin project JSON uploader (guard behind env flag)
        api/                # Next server routes proxying backend (optional)
        layout.tsx
        globals.css
      components/
        ui/                 # shadcn components
        filters/
        project/
        forms/
        theme/
      lib/
        api.ts              # HTTP client (fetch/TanStack Query utils)
        types.ts            # Shared TS types mirroring Zod/Prisma
        validators.ts       # Zod client mirrors
        utils.ts
    public/
    tailwind.config.ts
    postcss.config.js
    tsconfig.json
    package.json

  backend/
    src/
      index.ts              # Fastify bootstrap
      routes/
        projects.ts         # list/detail, import
        enrollments.ts      # create/read/update
        steps.ts            # checklist updates
        submissions.ts      # upload/validate
        health.ts
      services/
        project.service.ts
        enrollment.service.ts
      lib/
        prisma.ts           # Prisma client
        storage.ts          # File storage (local/S3)
        zodSchemas.ts       # Zod validators (single source of truth)
        mappers.ts          # JSON -> DB mappers
      jobs/
        importProjectFile.job.ts
      middlewares/
        errorHandler.ts
        cors.ts
    prisma/
      schema.prisma
      migrations/           # auto-generated
    storage/
      projects/             # if using local fs
    package.json

  .vscode/ (optional)
  README.md
  LICENSE
  turbo.json (optional)
  package.json (root workspace)  
```

---

## 3) Data Model (Prisma)

```prisma
// backend/prisma/schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Level { BEGINNER INTERMEDIATE ADVANCED }

enum GuidanceType { FULLY_GUIDED SEMI_GUIDED UNGUIDED }

enum SubmissionType { LINK FILE TEXT }

model Project {
  id           String   @id @default(cuid())
  slug         String   @unique
  title        String
  shortDesc    String
  longDesc     String
  classMin     Int      // e.g., 6
  classMax     Int      // e.g., 12
  level        Level
  guidance     GuidanceType
  subjects     ProjectSubject[]
  tags         ProjectTag[]
  tools        Tool[]
  prerequisites String[] @db.Text[]   // simple list
  durationHrs  Int?
  steps        Step[]                // ordered
  submission   SubmissionSpec?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  // Original JSON for traceability
  sourceJson   Json?
}

model Step {
  id          String  @id @default(cuid())
  projectId   String
  order       Int
  title       String
  description String
  checklist   ChecklistItem[]
  resources   Resource[]
  Project     Project @relation(fields: [projectId], references: [id])
}

model ChecklistItem {
  id        String  @id @default(cuid())
  stepId    String
  order     Int
  text      String
  Step      Step    @relation(fields: [stepId], references: [id])
}

model Resource {
  id        String @id @default(cuid())
  stepId    String
  title     String
  url       String
  type      String // video | article | dataset | notebook | code
  Step      Step   @relation(fields: [stepId], references: [id])
}

model Tool {
  id        String   @id @default(cuid())
  name      String
  Project   Project? @relation(fields: [projectId], references: [id])
  projectId String?
}

model Tag {
  id   String @id @default(cuid())
  name String @unique
  projects ProjectTag[]
}

model Subject {
  id   String @id @default(cuid())
  name String @unique
  projects ProjectSubject[]
}

model ProjectTag {
  projectId String
  tagId     String
  Project   Project @relation(fields: [projectId], references: [id])
  Tag       Tag     @relation(fields: [tagId], references: [id])
  @@id([projectId, tagId])
}

model ProjectSubject {
  projectId String
  subjectId String
  Project   Project @relation(fields: [projectId], references: [id])
  Subject   Subject @relation(fields: [subjectId], references: [id])
  @@id([projectId, subjectId])
}

model Enrollment {
  id          String   @id @default(cuid())
  projectId   String
  email       String
  name        String?
  school      String?
  classNum    Int
  createdAt   DateTime @default(now())
  progress    EnrollmentProgress[]
  submissions Submission[]
  Project     Project  @relation(fields: [projectId], references: [id])
}

model EnrollmentProgress {
  id           String  @id @default(cuid())
  enrollmentId String
  stepId       String
  checklistId  String?
  completed    Boolean @default(false)
  updatedAt    DateTime @updatedAt
  Enrollment   Enrollment @relation(fields: [enrollmentId], references: [id])
}

model SubmissionSpec {
  id            String         @id @default(cuid())
  projectId     String  @unique
  type          SubmissionType
  instruction   String
  allowedTypes  String[] @db.Text[] // for FILE: ['pdf','zip']
  Project       Project @relation(fields: [projectId], references: [id])
}

model Submission {
  id            String   @id @default(cuid())
  enrollmentId  String
  urlOrText     String   // URL to file or text content
  createdAt     DateTime @default(now())
  Enrollment    Enrollment @relation(fields: [enrollmentId], references: [id])
}
```

---

## 4) JSON Project File (Authoring Format)

**Upload one JSON file per project** (via Admin -> Upload). Backend validates via Zod, stores original JSON, and upserts normalized entities.

```json
{
  "slug": "digit-recognizer-cnn",
  "title": "Handwritten Digit Recognizer",
  "shortDesc": "Build a CNN to classify MNIST digits and deploy a simple web demo.",
  "longDesc": "Students train a CNN on MNIST, explore accuracy vs epochs, and publish a demo.",
  "classRange": { "min": 9, "max": 12 },
  "level": "INTERMEDIATE",
  "guidance": "FULLY_GUIDED",
  "subjects": ["Computer Science", "Mathematics"],
  "tags": ["CNN", "Vision", "Classification"],
  "tools": ["Python", "TensorFlow", "Colab"],
  "prerequisites": ["Basic Python", "Matrices", "Intro to Neural Nets"],
  "durationHrs": 8,
  "steps": [
    {
      "order": 1,
      "title": "Setup & Dataset",
      "description": "Open the starter notebook in Colab and load MNIST.",
      "checklist": [
        { "order": 1, "text": "Open Colab and copy notebook" },
        { "order": 2, "text": "Verify dataset shapes" }
      ],
      "resources": [
        { "title": "Starter Notebook", "url": "https://.../mnist.ipynb", "type": "notebook" },
        { "title": "What is MNIST?", "url": "https://...", "type": "article" }
      ]
    },
    {
      "order": 2,
      "title": "Build the CNN",
      "description": "Define layers, compile, and train the model.",
      "checklist": [
        { "order": 1, "text": "Add Conv2D + MaxPool" },
        { "order": 2, "text": "Train for 5 epochs" }
      ],
      "resources": []
    }
  ],
  "submission": {
    "type": "LINK",
    "instruction": "Submit the public link to your demo page.",
    "allowedTypes": []
  }
}
```

**Zod Validator (shared idea)**

```ts
const ProjectJson = z.object({
  slug: z.string().min(3),
  title: z.string().min(3),
  shortDesc: z.string().min(10),
  longDesc: z.string().min(10),
  classRange: z.object({ min: z.number().int().min(1), max: z.number().int().max(12) }),
  level: z.enum(["BEGINNER","INTERMEDIATE","ADVANCED"]),
  guidance: z.enum(["FULLY_GUIDED","SEMI_GUIDED","UNGUIDED"]),
  subjects: z.array(z.string()).nonempty(),
  tags: z.array(z.string()).default([]),
  tools: z.array(z.string()).default([]),
  prerequisites: z.array(z.string()).default([]),
  durationHrs: z.number().int().optional(),
  steps: z.array(z.object({
    order: z.number().int().min(1),
    title: z.string(),
    description: z.string(),
    checklist: z.array(z.object({ order: z.number().int(), text: z.string() })).default([]),
    resources: z.array(z.object({ title: z.string(), url: z.string().url(), type: z.string() })).default([])
  })).nonempty(),
  submission: z.object({
    type: z.enum(["LINK","FILE","TEXT"]),
    instruction: z.string(),
    allowedTypes: z.array(z.string()).default([])
  }).optional()
});
```

---

## 5) Backend API (Fastify)

**Base URL:** `BACKEND_URL` (e.g., `http://localhost:4000`)

### 5.1 Health

* `GET /health` → `{ ok: true }`

### 5.2 Projects

* `GET /projects` – query params (all optional):

  * `class` (number), `subject` (string), `tags` (comma list), `level` (enum), `guidance` (enum), `q` (search), `page`, `pageSize`
  * **Response:** `{ data: ProjectCardDTO[], page, total }`
* `GET /projects/:slug` → full project detail (`ProjectDetailDTO`)
* `POST /projects/import` – **Admin** (guard via header `x-admin-key`): multipart upload of JSON file(s). Validates and upserts.

### 5.3 Enrollment & Learning Flow

* `POST /enrollments` → body `{ projectSlug, email, name?, school?, classNum }` → `{ enrollmentId }`
* `GET /enrollments/:id` → `{ enrollment, project, stepsWithProgress }`
* `PATCH /enrollments/:id/checklist` → body `{ checklistId, completed }`
* `PATCH /enrollments/:id/step` → body `{ stepId, completed: boolean }` (optional high-level step completion)

### 5.4 Submission

* `POST /enrollments/:id/submissions` →

  * For `LINK`/`TEXT`: `{ urlOrText }`
  * For `FILE`: multipart (store via `storage.ts`). Returns `{ submissionId }`
* `GET /enrollments/:id/submissions` → list for confirmation page

**Error Shape (RFC 7807-ish):**

```json
{ "type": "https://docs/errors/validation", "title": "Invalid input", "status": 400, "detail": "...", "errors": [{ "path": "classNum", "message": "Must be between 1 and 12" }] }
```

---

## 6) Frontend Pages & UX

### 6.1 Layout

* **Global:** Dark theme default via `next-themes` `<ThemeProvider attribute="class" defaultTheme="dark">`.
* Top Nav: logo, Browse, (optional) Admin Upload (if `NEXT_PUBLIC_ENABLE_ADMIN`), ThemeToggle.

### 6.2 Browse (`/browse`)

* Left Filter Panel (sticky):

  * Class (range slider 1–12)
  * Subject (multi-select)
  * Level (pill radios: Beginner/Intermediate/Advanced)
  * Guidance (pill radios)
  * Tags (searchable multi-select)
  * Search box
  * Reset Filters button
* Grid of Project Cards (title, shortDesc, chips: class range, level, tags). Infinite scroll or paginated.

### 6.3 Project Detail (`/project/[slug]`)

* Header: title, level badge, class range, guidance chip.
* Tabs: Overview | Steps | Submission
* Overview: longDesc, prerequisites (bulleted), tools, subjects, tags, duration.
* CTA: **I’m interested / Enroll** → opens modal form (email, name, school, class). On success redirect to `/learn/[enrollmentId]`.

### 6.4 Learn Flow (`/learn/[enrollmentId]`)

* Left sidebar: steps list with completion state.
* Main panel: current Step title, description, Resources list, Checklist (each item checkbox toggles via API), Next/Prev Step buttons.
* Progress bar top/right.
* If `guidance == FULLY_GUIDED`: show teacher tips/tooltips. If `SEMI_GUIDED`: show optional hints collapsed.

### 6.5 Submission (`/submit/[enrollmentId]`)

* Render `SubmissionSpec` type-specific UI (link input, text area, or file upload).
* Confirmation list of previous submissions.

### 6.6 Admin Upload (`/admin/upload`)

* Only shown when `NEXT_PUBLIC_ENABLE_ADMIN = "true"` and `x-admin-key` available.
* Drag-n-drop JSON(s), validate client-side with Zod, preview parsed project summary, then POST to `/projects/import`.

---

## 7) Shared DTOs (TypeScript)

```ts
// frontend/src/lib/types.ts
export type Level = 'BEGINNER' | 'INTERMEDIATE' | 'ADVANCED';
export type GuidanceType = 'FULLY_GUIDED' | 'SEMI_GUIDED' | 'UNGUIDED';

export interface ProjectCardDTO {
  slug: string; title: string; shortDesc: string;
  classMin: number; classMax: number; level: Level;
  guidance: GuidanceType; tags: string[]; subjects: string[];
}

export interface ProjectDetailDTO extends ProjectCardDTO {
  longDesc: string;
  prerequisites: string[]; tools: string[]; durationHrs?: number;
  steps: Array<{ id: string; order: number; title: string; description: string; }>
  submission?: { type: 'LINK'|'FILE'|'TEXT'; instruction: string; allowedTypes: string[] }
}

export interface EnrollmentDTO {
  id: string; projectSlug: string; email: string; classNum: number;
}

export interface StepWithProgressDTO {
  step: { id: string; order: number; title: string; description: string; };
  checklist: Array<{ id: string; order: number; text: string; completed: boolean }>;
  resources: Array<{ id: string; title: string; url: string; type: string }>;
}
```

---

## 8) Theme & UI Guidelines (Dark/Light)

* `next-themes` with system preference support.
* Base tokens via Tailwind:

  * Background: `bg-neutral-900` (dark) / `bg-neutral-50` (light)
  * Surface: `bg-neutral-800` / `bg-white`
  * Text: `text-neutral-100` / `text-neutral-900`
  * Muted: `text-neutral-400` / `text-neutral-600`
* shadcn/ui components for Button, Card, Tabs, Badge, Input, Select, Checkbox, Progress, Switch.
* Focus rings + accessible contrast. No brand colors hard-coded.

---

## 9) Key Components (Frontend)

* `ThemeToggle.tsx` (switch)
* `ProjectCard.tsx` (level/tag chips)
* `FilterPanel.tsx` (controlled form → query params)
* `ProjectHeader.tsx`, `PrereqList.tsx`, `ToolsChips.tsx`
* `EnrollModal.tsx` (React Hook Form + Zod)
* `StepSidebar.tsx`, `StepView.tsx` (checklist, resources)
* `SubmissionForm.tsx` (type-aware)
* `AdminUploader.tsx` (dropzone + Zod preview)

---

## 10) Backend Endpoints – Pseudocode

```ts
// projects.ts
server.get('/projects', listProjectsHandler); // filters map to Prisma where
server.get('/projects/:slug', getProjectHandler);
server.post('/projects/import', { preHandler: [adminGuard, multipart] }, importProjectHandler);

// enrollments.ts
server.post('/enrollments', createEnrollment);
server.get('/enrollments/:id', getEnrollmentDetail);

// steps.ts
server.patch('/enrollments/:id/checklist', toggleChecklistItem);
server.patch('/enrollments/:id/step', setStepComplete);

// submissions.ts
server.post('/enrollments/:id/submissions', createSubmission);
server.get('/enrollments/:id/submissions', listSubmissions);
```

---

## 11) Import Flow (JSON → DB)

1. Admin uploads JSON via `/projects/import`.
2. Backend validates with Zod; on success:

   * Upsert **Subjects** and **Tags** tables.
   * Upsert **Project** by `slug` with normalized fields.
   * Replace `Steps`, `ChecklistItem`, `Resource`, `Tool` rows for that project (idempotent import).
   * Store original JSON in `Project.sourceJson`.
3. On failure: return 400 with Zod issues summary.

---

## 12) Filtering Logic (Server)

* `class`: `where: { classMin: { lte: class }, classMax: { gte: class } }`
* `subject`: join via `ProjectSubject` → `Subject.name` contains (case-insensitive)
* `tags`: any‑match (`some`) on `Tag.name in []`
* `level`, `guidance`: equals
* `q`: `title ilike %q% OR shortDesc ilike %q% OR tags/subjects contains q`
* Paginate with `skip/take` and `orderBy: updatedAt desc`.

---

## 13) Example UI Flows

* **Discover → Detail → Enroll → Learn → Submit**

  1. Browse filters → select project
  2. Detail page shows full metadata; enroll modal
  3. Learn page shows steps + resources + checklist
  4. Submit page enforces project’s `SubmissionSpec`

* **Admin Import**

  1. Drag JSON → validate → preview summary
  2. Upload → toast success → project appears in Browse

---

## 14) Security & Privacy (MVP)

* Store email & enrollment data only; no passwords.
* Rate-limit `POST` endpoints; CORS allow `frontend` origin.
* Validate file uploads by extension + MIME; virus scan stub (TODO hook).
* Admin import protected by static key header; rotate via env.

---

## 15) Scripts & Dev

* Root `pnpm` workspace with `frontend` and `backend`.
* `backend`: `pnpm prisma migrate dev`, `pnpm dev` (ts-node + nodemon), seeds optional.
* `frontend`: `pnpm dev` (Next.js), `NEXT_PUBLIC_BACKEND_URL` env.

---

##
